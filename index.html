<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Retirement Scenario Explorer</title>
<style>
  :root{
    --bg1:#1cc9c7; --bg2:#66d4e5; --bg3:#8fe0f0;
    --card:#ffffff; --ink:#0f172a; --muted:#475569; --accent:#10b981; --brand:#0ea5e9; --warn:#ef4444;
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;color:var(--ink);
    background: radial-gradient(1200px 600px at 10% -10%, #0fb1ea33, transparent),
               radial-gradient(1000px 500px at 100% 0%, #10b98133, transparent),
               linear-gradient(135deg,var(--bg1),var(--bg2) 40%,var(--bg3));
    min-height:100vh;}
  .wrap{max-width:1100px;margin:40px auto;padding:0 16px}
  .card{background:var(--card); border-radius:var(--radius); box-shadow:0 20px 40px rgba(2,8,23,.15);}
  .card h1{margin:0;padding:20px 24px;font-size:22px}
  .card .content{padding:20px 24px}
  .grid{display:grid; gap:16px}
  @media(min-width:900px){.grid.cols-3{grid-template-columns:1fr 1fr 1fr}}
  label{display:block;font-size:12px;color:var(--muted);margin:6px 0}
  input[type="number"], input[type="text"]{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;font-size:14px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .switch{display:flex;align-items:center;gap:8px;margin-top:6px}
  .btn{display:inline-block;background:linear-gradient(135deg,#0ea5e9,#14b8a6);color:#fff;border:none;padding:12px 16px;border-radius:999px;font-weight:600;cursor:pointer;box-shadow:0 10px 20px rgba(14,165,233,.25);} 
  .btn.secondary{background:#e2e8f0;color:#111827}
  .btnbar{display:flex;flex-wrap:wrap;gap:10px}
  .kpis{display:grid;gap:12px;margin-top:18px}
  @media(min-width:900px){.kpis{grid-template-columns:1fr 1fr 1fr}}
  .kpi{background:#fff;border-radius:14px;box-shadow:0 8px 20px rgba(2,8,23,.12);padding:14px}
  .kpi .t{font-size:12px;color:var(--muted)}
  .kpi .v{font-size:22px;font-weight:700}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:right}
  th:first-child, td:first-child, th:nth-child(2), td:nth-child(2){text-align:left}
  thead th{position:sticky;top:0;background:#f8fafc}
  .chart{height:320px;background:#fff;border-radius:14px;box-shadow:0 8px 20px rgba(2,8,23,.12);padding:10px}
  .legend{display:flex;gap:14px;align-items:center;font-size:12px;color:var(--muted);margin:6px 0}
  .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
  .dot.base{background:#2563eb}
  .dot.early{background:#0ea5e9}
  .dot.biz{background:#10b981}
  .note{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Retirement Scenario Explorer</h1>
      <div class="content grid cols-3">
        <!-- Col 1 -->
        <div>
          <label>Current Age</label>
          <input id="currentAge" type="number" value="43">
          <label>Current Portfolio ($)</label>
          <input id="currentBalance" type="number" value="551979">
          <label>Monthly Contribution ($)</label>
          <input id="monthlyContribution" type="number" value="4500">
          <div class="row">
            <div>
              <label>Return %</label>
              <input id="expectedReturn" type="number" value="7">
            </div>
            <div>
              <label>Inflation %</label>
              <input id="inflation" type="number" value="2.5">
            </div>
          </div>
          <label>One-time Addition (settlement) next year ($)</label>
          <input id="oneTime" type="number" value="150000">
        </div>
        <!-- Col 2 -->
        <div>
          <label>Retirement Age</label>
          <input id="retirementAge" type="number" value="52">
          <label>Annual Spending Target (today's $)</label>
          <input id="spending" type="number" value="70000">
          <div class="row">
            <div>
              <label>Early Extra Spend ($/yr)</label>
              <input id="earlyExtra" type="number" value="20000">
            </div>
            <div>
              <label>Early Extra Years</label>
              <input id="earlyYears" type="number" value="5">
            </div>
          </div>
          <div class="switch">
            <input id="includeSS" type="checkbox" checked>
            <label for="includeSS">Include Social Security</label>
          </div>
          <div class="row">
            <div>
              <label>SS Start Age</label>
              <input id="ssAge" type="number" value="67">
            </div>
            <div>
              <label>SS Annual (today's $)</label>
              <input id="ssAnnual" type="number" value="65000">
            </div>
          </div>
        </div>
        <!-- Col 3 -->
        <div>
          <label>Mortgage Payment Annual ($)</label>
          <input id="mortPmt" type="number" value="10762">
          <label>Mortgage Ends (age)</label>
          <input id="mortEnds" type="number" value="53">
          <div class="row">
            <div>
              <label>Model through Age</label>
              <input id="endAge" type="number" value="90">
            </div>
            <div>
              <label>Withdrawal Rule % (ref)</label>
              <input id="rule" type="number" value="4">
            </div>
          </div>
          $1
          <div class="btnbar" style="margin-top:8px">
            <button class="btn secondary" onclick="savePreset('base')">Save → Base</button>
            <button class="btn secondary" onclick="savePreset('early')">Save → Early‑Spend</button>
            <button class="btn secondary" onclick="savePreset('biz')">Save → Business‑Bridge</button>
          </div>
          <div class="note" style="margin-top:6px">Adjust any inputs, then click <b>Save → [Preset]</b> to overwrite that preset with your current settings. Presets are stored locally in your browser.</div>
          <div class="note" style="margin-top:8px">Presets:
            <b>Base</b> (your numbers), <b>Early‑Spend</b> (retire 50; extra $25k for 7y),
            <b>Business‑Bridge</b> (retire 52; business $14k/yr to 67).
          </div>
        </div>
      </div>
    </div>

    <div class="kpis">
      <div class="kpi"><div class="t">Portfolio at Retirement (Base)</div><div class="v" id="kpiRet">—</div></div>
      <div class="kpi"><div class="t">Portfolio at 67 (Base)</div><div class="v" id="kpi67">—</div></div>
      <div class="kpi"><div class="t">Age when 4% ≥ Target</div><div class="v" id="kpi4">—</div></div>
    </div>

    <div class="chart" style="margin-top:16px">
      <div class="legend">
        <span class="dot base"></span> Base
        <span class="dot early"></span> Early‑Spend
        <span class="dot biz"></span> Business‑Bridge
      </div>
      <svg id="chart" viewBox="0 0 900 300"></svg>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="content">
        <h2 style="margin:0 0 10px 0;font-size:18px">Year‑by‑Year (Base Scenario)</h2>
        <div style="max-height:360px;overflow:auto">
          <table id="table">
            <thead>
              <tr>
                <th>Year</th><th>Age</th><th>Contrib</th><th>Invest Return</th><th>SS</th><th>Business</th><th>Spend Need</th><th>Portfolio Withdraw</th><th>4% of End Bal</th><th>End Balance</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <p class="note" style="margin:12px 4px">* Spending and Social Security are inflation‑adjusted. One‑time settlement is added next year before growth. This is a planning tool, not advice.</p>
  </div>

<script>
function val(id){return Number(document.getElementById(id).value||0)}
function setVal(id,v){document.getElementById(id).value=v}
const money=n=>"$"+(Math.round(n).toLocaleString());
const yearNow=new Date().getFullYear();

function inflate(amount, years, infl){return amount*Math.pow(1+infl,years)}

function project(p){
  const rows=[]; let bal=p.currentBalance; const startAge=p.currentAge;
  for(let age=startAge; age<=p.endAge; age++){
    const i=age-startAge; let contrib = age<p.retirementAge ? p.monthlyContribution*12 : 0;
    // One-time addition next year
    if(i===1 && p.oneTime>0){ bal += p.oneTime; }
    const business = age<=p.businessEnds ? p.businessIncome : 0;
    const ss = p.includeSS && age>=p.ssAge ? inflate(p.ssAnnual, age-p.ssAge, p.inflation) : 0;

    let spend = inflate(p.spending, age-startAge, p.inflation);
    if(age<p.mortEnds){ spend += inflate(p.mortPmt, age-startAge, p.inflation); }
    if(age>=p.retirementAge && age<p.retirementAge+p.earlyYears){ spend += inflate(p.earlyExtra, age-p.retirementAge, p.inflation); }

    const growthOnBal = bal*p.return;
    const growthOnContrib = contrib*p.return*0.5; // half-year timing
    bal += contrib + growthOnBal + growthOnContrib;

    let portfolioWithdraw=0;
    if(age>=p.retirementAge){
      const gap = spend - (ss+business);
      portfolioWithdraw = Math.max(0,gap);
      bal -= portfolioWithdraw;
    }

    rows.push({age,year:yearNow+i,contrib,investReturn:growthOnBal+growthOnContrib,ss,business,spendNeeded:spend,portfolioWithdraw,endBalance:Math.max(0,bal)});
    if(bal<=0) break;
  }
  return rows;
}

function gather(){
  return {
    currentAge: val('currentAge'),
    currentBalance: val('currentBalance'),
    monthlyContribution: val('monthlyContribution'),
    return: val('expectedReturn')/100,
    inflation: val('inflation')/100,
    oneTime: val('oneTime'),
    retirementAge: val('retirementAge'),
    spending: val('spending'),
    earlyExtra: val('earlyExtra'),
    earlyYears: val('earlyYears'),
    includeSS: document.getElementById('includeSS').checked,
    ssAge: val('ssAge'),
    ssAnnual: val('ssAnnual'),
    mortPmt: val('mortPmt'),
    mortEnds: val('mortEnds'),
    endAge: val('endAge'),
    rule: val('rule')/100,
    businessIncome: 0,
    businessEnds: 67,
  }
}

function run(){
  const base=gather();
  const early={...base, retirementAge: Math.min(base.retirementAge,50), earlyExtra:25000, earlyYears:7};
  const biz={...base, retirementAge: Math.min(base.retirementAge,52), businessIncome:14000, businessEnds:67};
  const baseRows=project(base), earlyRows=project(early), bizRows=project(biz);
  renderKpis(baseRows, base);
  renderTable(baseRows, base);
  renderChart([baseRows, earlyRows, bizRows]);
}

function renderKpis(rows, base){
  const atRet = rows.find(r=>r.age===base.retirementAge);
  const at67 = rows.find(r=>r.age===67);
  const age4 = rows.find(r=> (r.endBalance*base.rule)>=base.spending );
  document.getElementById('kpiRet').textContent = atRet?money(atRet.endBalance):'—';
  document.getElementById('kpi67').textContent = at67?money(at67.endBalance):'—';
  document.getElementById('kpi4').textContent = age4?age4.age:'—';
}

function renderTable(rows, base){
  const tb=document.querySelector('#table tbody'); tb.innerHTML='';
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${r.year}</td><td>${r.age}</td>
      <td>${money(r.contrib)}</td><td>${money(r.investReturn)}</td><td>${money(r.ss)}</td>
      <td>${money(r.business)}</td><td>${money(r.spendNeeded)}</td><td>${money(r.portfolioWithdraw)}</td>
      <td>${money(r.endBalance*base.rule)}</td><td><b>${money(r.endBalance)}</b></td>`;
    tb.appendChild(tr);
  });
}

function renderChart(series){
  const svg=document.getElementById('chart'); svg.innerHTML='';
  const w=900,h=300,pad=36; // simple SVG line chart
  const colors=['#2563eb','#0ea5e9','#10b981'];
  let ages=[...new Set(series.flat().map(r=>r.age))].sort((a,b)=>a-b);
  const maxY=Math.max(...series.flat().map(r=>r.endBalance),1);
  const x=age=> pad + ( (age-ages[0])/(ages[ages.length-1]-ages[0]||1) )*(w-2*pad);
  const y=val=> h-pad - (val/maxY)*(h-2*pad);
  // axes
  const ax=document.createElementNS('http://www.w3.org/2000/svg','path');
  ax.setAttribute('d',`M${pad},${h-pad} L${w-pad},${h-pad} M${pad},${h-pad} L${pad},${pad}`);
  ax.setAttribute('stroke','#cbd5e1'); ax.setAttribute('fill','none'); svg.appendChild(ax);
  // y labels
  for(let i=0;i<=4;i++){
    const val=maxY*i/4; const yy=y(val);
    const l=document.createElementNS('http://www.w3.org/2000/svg','text');
    l.setAttribute('x','6'); l.setAttribute('y',yy+4); l.setAttribute('font-size','10'); l.setAttribute('fill','#64748b');
    l.textContent = '$'+Math.round(val/100000)/10+'M'; svg.appendChild(l);
    const g=document.createElementNS('http://www.w3.org/2000/svg','line');
    g.setAttribute('x1',pad); g.setAttribute('x2',w-pad); g.setAttribute('y1',yy); g.setAttribute('y2',yy); g.setAttribute('stroke','#e2e8f0'); g.setAttribute('stroke-dasharray','3,3'); svg.appendChild(g);
  }
  // series lines
  series.forEach((rows,si)=>{
    const d=rows.map((r,idx)=> (idx? 'L':'M')+x(r.age)+','+y(r.endBalance)).join(' ');
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',d); p.setAttribute('fill','none'); p.setAttribute('stroke',colors[si]); p.setAttribute('stroke-width','2');
    svg.appendChild(p);
  });
}

function loadPresets(){
  try{ return JSON.parse(localStorage.getItem('rse-presets')||'{}'); }catch(e){ return {}; }
}
function storePresets(p){ localStorage.setItem('rse-presets', JSON.stringify(p)); }
function defaultPresets(){
  return {
    base: { retirementAge:52, earlyExtra:20000, earlyYears:5, monthlyContribution:4500, oneTime:150000, spending:70000, expectedReturn:7, inflation:2.5, ssAge:67, ssAnnual:65000, businessIncome:0, businessEnds:67 },
    early:{ retirementAge:50, earlyExtra:25000, earlyYears:7, monthlyContribution:3500, oneTime:150000, spending:70000, expectedReturn:7, inflation:2.5, ssAge:67, ssAnnual:65000, businessIncome:0, businessEnds:67 },
    biz:  { retirementAge:52, earlyExtra:15000, earlyYears:3,  monthlyContribution:4500, oneTime:150000, spending:70000, expectedReturn:7, inflation:2.5, ssAge:67, ssAnnual:65000, businessIncome:14000, businessEnds:67 }
  };
}
function applyPresetVals(vals){
  if(vals.retirementAge!=null) setVal('retirementAge', vals.retirementAge);
  if(vals.earlyExtra!=null) setVal('earlyExtra', vals.earlyExtra);
  if(vals.earlyYears!=null) setVal('earlyYears', vals.earlyYears);
  if(vals.monthlyContribution!=null) setVal('monthlyContribution', vals.monthlyContribution);
  if(vals.oneTime!=null) setVal('oneTime', vals.oneTime);
  if(vals.spending!=null) setVal('spending', vals.spending);
  if(vals.expectedReturn!=null) setVal('expectedReturn', vals.expectedReturn);
  if(vals.inflation!=null) setVal('inflation', vals.inflation);
  if(vals.ssAge!=null) setVal('ssAge', vals.ssAge);
  if(vals.ssAnnual!=null) setVal('ssAnnual', vals.ssAnnual);
}
function preset(which){
  const p = { ...defaultPresets(), ...loadPresets() };
  const vals = p[which] || p.base;
  applyPresetVals(vals);
  run();
}
function savePreset(which){
  const p = { ...defaultPresets(), ...loadPresets() };
  // capture current inputs
  p[which] = {
    retirementAge: val('retirementAge'),
    earlyExtra: val('earlyExtra'),
    earlyYears: val('earlyYears'),
    monthlyContribution: val('monthlyContribution'),
    oneTime: val('oneTime'),
    spending: val('spending'),
    expectedReturn: val('expectedReturn'),
    inflation: val('inflation'),
    ssAge: val('ssAge'),
    ssAnnual: val('ssAnnual'),
    businessIncome: which==='biz' ? 14000 : 0,
    businessEnds: 67,
  };
  storePresets(p);
  alert('Saved current inputs to the "'+(which==='base'?'Base':which==='early'?'Early‑Spend':'Business‑Bridge')+'" preset.');
}

// first paint
run();
</script>
</body>
</html>
